---
import EvaluationFormComponent from '~/components/core/EvaluationFormComponent';
import Layout from '~/layouts/PageLayout.astro';
import { getProfessorById } from '~/service/professor-service';

const metadata = {
  title: 'Rate My Professor: Create An Evaluation',
};

let professorId = Astro.url.searchParams.get('professorId');

let professor = professorId && (await getProfessorById(Astro, Number(professorId)));

// look up school and professor info and pass to EvaluationFormComponent
---

<Layout metadata={metadata}>
  <script define:vars={{ professor }}>
    window.professor = professor;
  </script>
  <EvaluationFormComponent client:only="react" />
</Layout>

<script is:inline>
  function initTurnstile() {
    if (document.getElementById('tswidget-container')) {
      window.tsWidgetId = turnstile.render('#tswidget-container', {
        sitekey: '0x4AAAAAAAeljwsqh-QqLV4T',
        callback: function (token) {
          window.turnstileToken = token;
          console.log(`Challenge Success ${token}`);
        },
      });

      window.removeTsWidget = function () {
        document.getElementById('tswidget-container').style.display = 'none';
      };
    } else {
      setTimeout(initTurnstile, 1000);
    }
  }
  window.onloadTurnstileCallback = function () {
    initTurnstile();
  };
</script>

<script is:inline src="https://challenges.cloudflare.com/turnstile/v0/api.js?onload=onloadTurnstileCallback" defer
></script>"
