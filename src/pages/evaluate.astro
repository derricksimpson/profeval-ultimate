---
import EvaluationFormComponent from '~/components/core/EvaluationFormComponent';
import Layout from '~/layouts/PageLayout.astro';
import { getProfessorById } from '~/service/professor-service';

const metadata = {
  title: 'Rate My Professor: Create An Evaluation',
};

let professorId = Astro.url.searchParams.get('professorId');

let professor = professorId && (await getProfessorById(Astro, Number(professorId)));

console.log('professor:', professor);

// look up school and professor info and pass to EvaluationFormComponent
---

<Layout metadata={metadata}>
  <script define:vars={{ professor }}>
    window.professor = professor;
  </script>
  <EvaluationFormComponent client:only="react" />
</Layout>

<script is:inline>
  function initTurnstile() {
    // seach for element
    if (document.getElementById('example-container')) {
      turnstile.render('#example-container', {
        sitekey: '0x4AAAAAAAeljwsqh-QqLV4T',
        callback: function (token) {
          console.log(`Challenge Success ${token}`);
        },
      });
    } else {
      setTimeout(initTurnstile, 1000);
    }
  }
  window.onloadTurnstileCallback = function () {
    initTurnstile();
  };
</script>

<script is:inline src="https://challenges.cloudflare.com/turnstile/v0/api.js?onload=onloadTurnstileCallback" defer
></script>"
